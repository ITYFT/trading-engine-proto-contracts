syntax = "proto3";
package trading_engine;
import "google/protobuf/empty.proto";

enum UpdateAccountMetadataMode{
    Merge = 0;
    Update = 1;
}

message TradingEngineUpdateMetadataGrpcModel{
    UpdateAccountMetadataMode Mode = 1;
    map<string, string> Metadata = 2;
}

message TradingEngineSwapGrpcModel{
    int64 Date = 1;
    double Delta = 2;
}


enum TradingEngineOrderGrpType{
    Market = 0;
    Stop = 1;
    Limit = 2;
}

enum TradingEngineGrpcError{
    AccountNotFound = 0;
    DayOff = 1;
    ReceiverAccountNotFound = 2;
    TradingGroupNotFound = 3;
    AssetPairTradingSettingsNotFound = 4;
    NotEnoughBalance = 5;
    InvalidBalanceTransferAmount = 6;
    AssetPairPriceNotFound = 7;
    CommissionPriceNotFound = 8;
    MarginPriceNotFound = 9;
    AssetPairNotFound = 10;
    ProfitPriceNotFound = 11;
    AccountTradingDisabled = 12;
    NoLiquidity = 13;
    InvalidSl = 14;
    InvalidTp = 15;
    PositionNotFound = 16;
    InvalidOrderPartialExecutionQuantity = 17;
    TradingInstrumentSettingsNotFound = 18;
    OperationNotSupportForThisOrderType = 19;
    OrderNotFound = 20;
    InvalidCollateral = 21;
    AccountDuplicate = 22;
    InvalidLeverage = 23;
    CollateralNotFoundInGroupSettings = 24;
    TradingAccountSettingsNotFound = 25;
    LotsTooLow = 26;
    LotsTooHigh = 27;
    InvalidDesirePrice = 28;
}

message TradingEngineOrderGrpcModel{
    string Id = 1;
    string TraderId = 2;
    string AccountId = 3;
    string AssetPair = 4;
    string Collateral = 5;
    double LotsAmount = 6;
    bool IsBuy = 7;
    optional double SlPrice = 8;
    optional double TpPrice = 9;
    map<string, string> Metadata = 10;
    TradingEngineOrderGrpType OrderType = 11;

    int64 CreateDate = 12;
    int64 UpdateData = 13;

    string CreateProcessId = 14;
    string LastUpdateProcessId = 15;

    optional double DesirePrice = 16;

    bool IsClose = 17;
}

message TradingEngineAdminUpdateOrderGrpcModel {
    string Collateral = 1;
    double LotsAmount = 2;
    bool IsBuy = 3;
    optional double SlPrice = 4;
    optional double TpPrice = 5;
    optional double DesirePrice = 6;
    map<string, string> Metadata = 7;
    TradingEngineOrderGrpType OrderType = 8;

    int64 CreateDate = 9;
    int64 UpdateDate = 10;

    string CreateProcessId = 11;
    string LastUpdateProcessId = 12;

    bool IsClose = 13;
}


message TradingEngineAdminUpdateTradeGrpcModel {
    string OrderId = 1;
    string PositionId = 2;
    double Price = 3;
    double Pl = 4;
    double Fee = 5;
    double LotsAmount = 6;
    int64 CreateDate = 7;
    string CreateProcessId = 8;
    bool IsBuy = 9;
}


message TradingEngineTradeGrpcModel {
    string Id = 1;
    string TraderId = 2;
    string AccountId = 3;
    string AssetPair = 4;
    string OrderId = 5;
    string PositionId = 6;
    double Price = 7;
    double Pl = 8;
    double Fee = 9;
    double LotsAmount = 10;
    int64 CreateDate = 11;
    string CreateProcessId = 12;
    bool IsBuy = 13;
}

message TradingEngineAdminBidAskGrpcModel{
    string AssetPair = 1;
    double Bid = 2;
    double Ask = 3;
    int64 Date = 4;
    string Base = 5;
    string Quote = 6;
}

message TradingEngineBidAskGrpcModel{
    string AssetPair = 1;
    double Bid = 2;
    double Ask = 3;
    int64 Date = 4;
}

message TradingEnginePlaceOrderGrpcRequest{
    string TraderId = 1;
    string AccountId = 2;
    string AssetPair = 3;
    double LotsAmount = 5;
    bool IsBuy = 6;
    optional double SlPrice = 7;
    optional double TpPrice = 8;
    map<string, string> Metadata = 9;
    TradingEngineOrderGrpType OrderType = 10;
    optional double DesirePrice = 11;
    string ProcessId = 12;
}

message PlaceOrderGrpcResponse{
    oneof PlaceOrderGrpcResponseResult{
        TradingEngineOrderGrpcModel Order = 1;
        TradingEngineGrpcError ErrorMessage = 2;
    }
}

message TradingEngineGetAccountOrdersGrpcRequest{
    string TraderId = 1;
    string AccountId = 2;
}

message TradingEngineCancelOrderGrpcRequest{
    string TraderId = 1;
    string AccountId = 2;
    string OrderId = 3;
}
message TradingEngineForceCancelOrderGrpcRequest{
    string TraderId = 1;
    string AccountId = 2;
    string OrderId = 3;
}

message CancelOrderGrpcResponse{
    oneof CancelOrderGrpcResponseResult{
        TradingEngineOrderGrpcModel Order = 1;
        TradingEngineGrpcError ErrorMessage = 2;
    }
}

message TradingEngineUpdateOrderGrpcRequest{
    string TraderId = 1;
    string AccountId = 2;
    string OrderId = 3;
    string ProcessId = 4;
    optional double TpPrice = 5;
    optional double SlPrice = 6;
    optional double DesirePrice = 7;
    optional TradingEngineUpdateMetadataGrpcModel Metadata = 8;
    optional double LotsAmount = 9;
}

message TradingEngineActivePositionGrpcModel{
    string Id = 1;
    string TraderId = 2;
    string AccountId = 3;
    string AssetPair = 4;
    string Collateral = 5;
    double LotsAmount = 6;
    bool IsBuy = 7;
    optional double SlPrice = 8;
    optional double TpPrice = 9;
    map<string, string> Metadata = 10;

    int64 CreateDate = 11;
    int64 UpdateData = 12;

    string CreateProcessId = 13;
    string LastUpdateProcessId = 14;

    TradingEngineBidAskGrpcModel OpenBidAsk = 15;
    TradingEngineBidAskGrpcModel MarginBidAsk = 16;
    TradingEngineBidAskGrpcModel ProfitBidAsk = 17;
    TradingEngineBidAskGrpcModel ActiveBidAsk = 18;

    double Pl = 19;
    repeated TradingEngineSwapGrpcModel Swaps = 20;
    double Commission = 21;
    string OrderId = 22;
}

message TradingEngineUpdateOrderGrpcResponse{
    oneof UpdateOrderGrpcResponseResult{
        TradingEngineOrderGrpcModel Order = 1;
        TradingEngineGrpcError ErrorMessage = 2;
    }
}

message TradingEngineClosePositionGrpcRequest{
    string TraderId = 1;
    string AccountId = 2;
    string PositionId = 3;
    string ProcessId = 4;
}
message TradingEngineForceClosePositionGrpcRequest{
    string TraderId = 1;
    string AccountId = 2;
    string PositionId = 3;
    string ProcessId = 4;
}

message TradingEngineClosePositionGrpcResponse{
    oneof ClosePositionGrpcResponseResult{
        TradingEngineOrderGrpcModel CloseOrder = 1;
        TradingEngineGrpcError ErrorMessage = 2;
    }
}

message TradingEngineUpdatePositionGrpcRequest{
    string TraderId = 1;
    string AccountId = 2;
    string PositionId = 3;
    string ProcessId = 4;
    optional double TpPrice = 5;
    optional double SlPrice = 6;
    optional TradingEngineUpdateMetadataGrpcModel Metadata = 7;
}

message TradingEngineUpdatePositionGrpcResponse{
    oneof UpdatePositionGrpcResponseResult{
        TradingEngineActivePositionGrpcModel Position = 1;
        TradingEngineGrpcError ErrorMessage = 2;
    }
}

message TradingEngineGetAccountPositionsGrpcRequest{
    string TraderId = 1;
    string AccountId = 2;
}

message TradingEngineAdminActivePositionGrpcModel {
    string Id = 1;
    string TraderId = 2;
    string AccountId = 3;
    string AssetPair = 4;
    string Collateral = 5;
    double LotsAmount = 6;
    bool IsBuy = 7;
    bool IsAbook = 8;
    optional double SlPrice = 9;
    optional double TpPrice = 10;
    map<string, string> Metadata = 11;
    string OrderId = 12;
    
    TradingEngineAdminBidAskGrpcModel MarginBidAsk = 13;
    TradingEngineAdminBidAskGrpcModel OpenBidAsk = 14;
    TradingEngineAdminBidAskGrpcModel ProfitBidAsk = 15;
    TradingEngineAdminBidAskGrpcModel ActiveBidAsk = 16;
    
    double Commission = 17;
    double Pl = 18;
    repeated TradingEngineSwapGrpcModel Swaps = 19;

    int64 CreateDate = 20;
    int64 UpdateDate = 21;
    string CreateProcessId = 22;
    string LastUpdateProcessId = 23;
}

message TradingEngineAdminUpdateActivePositionGrpcModel {
    string Collateral = 5;
    double LotsAmount = 6;
    bool IsBuy = 7;
    bool IsAbook = 8;
    optional double SlPrice = 9;
    optional double TpPrice = 10;
    map<string, string> Metadata = 11;
    string OrderId = 12;
    
    TradingEngineAdminBidAskGrpcModel MarginBidAsk = 13;
    TradingEngineAdminBidAskGrpcModel OpenBidAsk = 14;
    TradingEngineAdminBidAskGrpcModel ProfitBidAsk = 15;
    TradingEngineAdminBidAskGrpcModel ActiveBidAsk = 16;
    
    double Commission = 17;
    double Pl = 18;
    repeated TradingEngineSwapGrpcModel Swaps = 19;

    int64 CreateDate = 20;
    int64 UpdateDate = 21;
    string CreateProcessId = 22;
    string LastUpdateProcessId = 23;
}


message TradingEngineAdminUpdateClosedPositionGrpcModel {
    string Collateral = 5;
    double LotsAmount = 6;
    bool IsBuy = 7;
    bool IsAbook = 8;
    optional double SlPrice = 9;
    optional double TpPrice = 10;
    map<string, string> Metadata = 11;
    string OrderId = 12;
    
    TradingEngineAdminBidAskGrpcModel MarginBidAsk = 13;
    TradingEngineAdminBidAskGrpcModel OpenBidAsk = 14;
    TradingEngineAdminBidAskGrpcModel ProfitBidAsk = 15;
    TradingEngineAdminBidAskGrpcModel CloseBidAsk = 16;  
    
    TradingEngineAdminPositionCloseReason CloseReason = 17;
    double Commission = 18;
    double Pl = 19;
    repeated TradingEngineSwapGrpcModel Swaps = 20;
    
    int64 CreateDate = 21;        
    int64 CloseDate = 22;         
    string CreateProcessId = 23;
    string CloseProcessId = 24;   
}

message TradingEngineAdminClosedPositionGrpcModel {
    string Id = 1;
    string TraderId = 2;
    string AccountId = 3;
    string AssetPair = 4;
    string Collateral = 5;
    double LotsAmount = 6;
    bool IsBuy = 7;
    bool IsAbook = 8;
    optional double SlPrice = 9;
    optional double TpPrice = 10;
    map<string, string> Metadata = 11;
    string OrderId = 12;
    
    TradingEngineAdminBidAskGrpcModel MarginBidAsk = 13;
    TradingEngineAdminBidAskGrpcModel OpenBidAsk = 14;
    TradingEngineAdminBidAskGrpcModel ProfitBidAsk = 15;
    TradingEngineAdminBidAskGrpcModel CloseBidAsk = 16;  
    
    TradingEngineAdminPositionCloseReason CloseReason = 17;
    double Commission = 18;
    double Pl = 19;
    repeated TradingEngineSwapGrpcModel Swaps = 20;
    
    int64 CreateDate = 21;        
    int64 CloseDate = 22;         
    string CreateProcessId = 23;
    string CloseProcessId = 24;   
}

enum TradingEngineAdminPositionCloseReason {
    Manual = 0;
    Sl = 1;
    Tp = 2;
    So = 3;
    Admin = 4;
}

message TradingEngineAdminCreatePositionGrpcRequest {
    oneof Position {
        TradingEngineAdminActivePositionGrpcModel OpenPosition = 1;
        TradingEngineAdminClosedPositionGrpcModel ClosedPosition = 2;
    }
    TradingEngineOrderGrpcModel OpenOrder = 3;
    TradingEngineTradeGrpcModel OpenTrade = 4;
    optional TradingEngineOrderGrpcModel CloseOrder = 5;
    optional TradingEngineTradeGrpcModel CloseTrade = 6;
}

message TradingEngineAdminUpdatePositionGrpcRequest {
    oneof Position {
        TradingEngineAdminUpdateActivePositionGrpcModel OpenPosition = 1;
        TradingEngineAdminUpdateClosedPositionGrpcModel ClosedPosition = 2;
    }
    TradingEngineAdminUpdateOrderGrpcModel OpenOrder = 3;
    TradingEngineAdminUpdateTradeGrpcModel OpenTrade = 4;
    optional TradingEngineAdminUpdateOrderGrpcModel CloseOrder = 5;
    optional TradingEngineAdminUpdateTradeGrpcModel CloseTrade = 6;
}

message TradingEngineAdminCreatePositionGrpcResult {
    oneof Position {
        TradingEngineAdminActivePositionGrpcModel OpenPosition = 1;
        TradingEngineAdminClosedPositionGrpcModel ClosedPosition = 2;
    }
    TradingEngineOrderGrpcModel Order = 3;
    TradingEngineTradeGrpcModel Trade = 4;
}


message TradingEngineAdminCreatePositionGrpcResponse {
    oneof result {
        TradingEngineAdminCreatePositionGrpcResult Success = 1;
        TradingEngineGrpcError Error = 2;
    }
}

message TradingEngineAdminUpdatePositionGrpcResult {
    oneof Position {
        TradingEngineAdminActivePositionGrpcModel OpenPosition = 1;
        TradingEngineAdminClosedPositionGrpcModel ClosedPosition = 2;
    }
    TradingEngineOrderGrpcModel Order = 3;
    TradingEngineTradeGrpcModel Trade = 4;
}

message TradingEngineAdminUpdatePositionGrpcResponse {
    oneof result {
        TradingEngineAdminUpdatePositionGrpcResult Success = 1;
        TradingEngineGrpcError Error = 2;
    }
}

message TradingEngineAdminDeletePositionGrpcRequest {
    string PositionId = 1;
}

message TradingEngineAdminDeletePositionGrpcResponse {
    oneof result {
        google.protobuf.Empty Success = 1;
        TradingEngineGrpcError Error = 2;
    }
}

service TradingEngineService{
    rpc GetAllOrders(google.protobuf.Empty) returns (stream TradingEngineOrderGrpcModel);
    rpc PlaceOrder(TradingEnginePlaceOrderGrpcRequest) returns (PlaceOrderGrpcResponse);
    rpc GetAccountOrders(TradingEngineGetAccountOrdersGrpcRequest) returns (stream TradingEngineOrderGrpcModel);
    rpc CancelOrder(TradingEngineCancelOrderGrpcRequest) returns (CancelOrderGrpcResponse);
    rpc ForceCancelOrder(TradingEngineForceCancelOrderGrpcRequest) returns (CancelOrderGrpcResponse);
    rpc UpdateOrder(TradingEngineUpdateOrderGrpcRequest) returns (TradingEngineUpdateOrderGrpcResponse);

    rpc GetAllPositions(google.protobuf.Empty) returns (stream TradingEngineActivePositionGrpcModel);
    rpc ClosePosition(TradingEngineClosePositionGrpcRequest) returns (TradingEngineClosePositionGrpcResponse);
    rpc ForceClosePosition(TradingEngineForceClosePositionGrpcRequest) returns (TradingEngineClosePositionGrpcResponse);
    rpc UpdatePosition(TradingEngineUpdatePositionGrpcRequest) returns (TradingEngineUpdatePositionGrpcResponse);
    rpc GetAccountPositions(TradingEngineGetAccountPositionsGrpcRequest) returns (stream TradingEngineActivePositionGrpcModel);
    rpc AdminCreatePosition(TradingEngineAdminCreatePositionGrpcRequest) returns (TradingEngineAdminCreatePositionGrpcResponse);
    rpc AdminUpdatePosition(TradingEngineAdminUpdatePositionGrpcRequest) returns (TradingEngineAdminUpdatePositionGrpcResponse);
    rpc AdminDeletePosition(TradingEngineAdminDeletePositionGrpcRequest) returns (TradingEngineAdminDeletePositionGrpcResponse);

    rpc Ping(google.protobuf.Empty) returns (google.protobuf.Empty);
}